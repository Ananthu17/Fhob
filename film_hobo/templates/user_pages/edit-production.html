{% extends 'base.html' %}
{% load static %}
{% load profile_photo_tag %}
{% load token %}

{% block extracss %}
<style>
    .select2-container {
      border: 1px solid transparent!important;
      border-radius: 0;
      margin-top:.5rem!important;
  }
</style>
{% endblock %}

{% block content %}
{% get_my_token request as token %}
<input type = "hidden" value="{{token}}" name="token" id="token"/>
<div class="wrapper flex-grow-1">
    <div class="container-fluid member-setup-sec">
        <div class="row">
            <div class="col-lg-2 col-md-12 col-sm-12 col-xs-12 mt-3">
                 <div class="left-mode-sec p-2">View profile in:
                    <button class="btn btn-mem-mode btn-block mt-2">Edit Mode</button>
                    <a class="btn btn-mem-mode btn-block mt-2"
                    href="{% url 'hobo_user:production-company-profile' request.user.id %}">
                        Public Mode
                    </a>
                </div>
                <div class="left-mode-sec mt-3 p-2">
                    <!-- <ul class="list-unstyled p-2 mb-0">
                        <li><a href="#" class="membr-setup-m">My Interests (5)</a></li>
                        <li class="mt-4"><a href="#" class="membr-setup-m">My Projects (2)</a></li>
                    </ul> -->
                </div>
                <div class="left-mode-sec mt-3 p-2 blank-left-mode">
                </div> 
            </div>
            <div class="col-lg-2 col-md-12 col-sm-12 col-xs-12 mt-3 pl-1 pr-1">
                <!-- <div class="left-mode-sec mem-img-p">
                    <div class="row">
                        <div class="col-12 mem-set-img">
                            {% get_profile_photo request.user as image %}
                            {% if image %}
                            <img src="{{ image }}" class="img-fluid mem-set-top-img" />
                            {% else %}
                            <img src="{% static 'images/default_profile_pic.png' %}" class="img-fluid mem-set-top-img">
                            {% endif %}
                        </div>
                    </div>
                    <div class="row mt-1">
                        {% for obj in photos %}
                        <div class="col-4 mem-set-img">
                            <img src="{{ obj.image.url }}" class="img-fluid  mem-set-img-s" />
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="mt-3 mem-set-add-sec">
                    <div class=" mb-2 text-center"> <a href="{% url 'hobo_user:friends-and-followers' %}" class="mem-setup-blu-f" >Add/Remove Pictures</a></div>
                    <div class="row">
                        {% for obj in all_photos %}
                        <div class="col-3 mem-set-img">
                            <img src="{{ obj.image.url }}" class="img-fluid mem-set-img-add">
                        </div>
                        {% endfor %}
                    </div>
                    <div class="mem-setup-blck-f mt-2 mb-3">#1 is a Profile Picture. You can
                        flip pictures any time</div>
                </div>
                <div class="mem-set-network-sec mt-3">
                    <div class="mem-setup-blu-f mb-1 float-left">Network/Friends</div>
                    <div class="float-right"><a href="#" class="mem-setup-blck-f">Edit</a></div>
                    <hr class="mem-setup-network-hr">
                    <div class="row pl-1 pr-1">
                        <div class="col-3 mem-set-net-img">
                            <img src="{% static 'images/img0.PNG' %}" class="img-fluid mem-set-img-add">
                            <div class="mem-set-img-add-nam">Name Name</div>
                        </div>
                        <div class="col-3 mem-set-net-img">
                            <img src="{% static 'images/img1.PNG' %}" class="img-fluid mem-set-img-add">
                            <div class="mem-set-img-add-nam">Name Name</div>
                        </div>
                        <div class="col-3 mem-set-net-img">
                            <img src="{% static 'images/img2.PNG' %}" class="img-fluid mem-set-img-add">
                            <div class="mem-set-img-add-nam">Name Name</div>
                        </div>
                        <div class="col-3 mem-set-net-img">
                            <img src="{% static 'images/img3.PNG' %}" class="img-fluid mem-set-img-add">
                            <div class="mem-set-img-add-nam">Name Name</div>
                        </div>
                    </div>
                    <div class="row mt-3 pl-1 pr-1">
                        <div class="col-3 mem-set-net-img">
                            <img src="{% static 'images/img0.PNG' %}" class="img-fluid mem-set-img-add">
                            <div class="mem-set-img-add-nam">Name Name</div>
                        </div>
                        <div class="col-3 mem-set-net-img">
                            <img src="{% static 'images/img1.PNG' %}" class="img-fluid mem-set-img-add">
                            <div class="mem-set-img-add-nam">Name Name</div>
                        </div>
                        <div class="col-3 mem-set-net-img">
                            <img src="{% static 'images/img2.PNG' %}" class="img-fluid mem-set-img-add">
                            <div class="mem-set-img-add-nam">Name Name</div>
                        </div>
                        <div class="col-3 mem-set-net-img">
                            <img src="{% static 'images/img3.PNG' %}" class="img-fluid mem-set-img-add">
                            <div class="mem-set-img-add-nam">Name Name</div>
                        </div>
                    </div>
                </div>

                <div class="mem-set-network-sec mt-3 mb-4">
                    <div class="mb-1 float-left"><a href="#" class="mem-setup-orng-f">({{tracking_list.count}})Tracking</a></div>
                    <div class="float-right"><a href="#" class="mem-setup-blu-f">({{trackers_list.count}})Trackers</a></div>
                    <hr class="mem-setup-network-hr">
                    <div class="mem-set-track-txt mb-1"><span class="underline">People</span> ({{tracking_list.count}})</div>
                    <div class="row pl-3 pr-3">
                        {% for usr in tracking_list %}
                        <div class="col-2 mem-set-img">
                            {% get_profile_photo usr as image %}
                            {% if image %}
                            <img src="{{ image }}" class="img-fluid mem-set-img-track">
                            {% else %}
                            <img src="{% static 'images/default_profile_pic.png' %}" class="img-fluid mem-set-img-track">
                            {% endif %}
                            <div class="mem-set-img-track-nam">{{ usr.user.get_full_name|truncatechars:"9"}}</div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="mem-set-track-txt mt-1 mb-1"><span class="underline">Projects</span> (3)</div>
                    <div class="row">
                        <div class="col-4 ">
                            <div class="track-blu-f">Project<span class="track-orng-f">#224</span></div>
                            <div class="track-blu-f">Title:<span class="track-orng-f">Dynamo</span></div>
                        </div>
                        <div class="col-4 mem-set-track-padding">
                            <div class="track-blu-f">Project<span class="track-orng-f">#56</span></div>
                            <div class="track-blu-f">Title:<span class="track-orng-f">Jack</span></div>
                        </div>
                        <div class="col-4 mem-set-track-padding pl-0">
                            <div class="track-blu-f">Project<span class="track-orng-f">#457</span></div>
                            <div class="track-blu-f">Title:<span class="track-orng-f">Hammer</span></div>
                        </div>
                    </div>
                    <div class="mem-set-track-txt mt-1 mb-1"><span class="underline">Teams</span> (2)</div>
                    <div class="row">
                        <div class="col-6">
                            <div class="track-blu-f">Project<span class="track-orng-f">#224</span></div>
                            <div class="track-blu-f">Team:<span class="track-orng-f">#3</span></div>
                            <div class="track-blu-f">Location:<span class="track-orng-f">Dallas</span></div>
                        </div>
                        <div class="col-6 mem-set-track-padding">
                            <div class="track-blu-f">Project<span class="track-orng-f">#178</span></div>
                            <div class="track-blu-f">Team:<span class="track-orng-f">#1</span></div>
                            <div class="track-blu-f">Location:<span class="track-orng-f">New York</span></div>
                        </div>
                    </div>
                </div> -->
            </div>
            <div class="col-lg-8 col-md-12 col-sm-12 col-xs-12 mt-3">
                <div class="container p-0">
                <hr class="mem-set-acc-hr">
                <div>Account Info <img src="{% static 'images/edit.png' %}" class="img-fluid edit-icon ml-3"></div>
                <form method="post" action="{% url 'hobo_user:edit-production-company-profile' %}">
                    {% csrf_token %}
                <div class="row mt-2">
                    <div class="col-1 ">
                        <label class="mem-setup-blu-f mt-3">Company</label>
                    </div>
                    <div class="col-5 ">
                        <input class="inp-line" placeholder="Website"
                        name="{{ form.company_name.name }}"
                        value="{% if user.company_name %}{{ user.company_name}}{% endif%}"
                        autocomplete="off"/>
                        {% if errors.company_name %}
                        {% for err in errors.company_name %}
                        <p style="color: red">{{err}}</p>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-1">
                        <label class="form-title mem-setup-blu-f">Status:</label>
                    </div>
                    <div class="col-5 mt-2">
                        <span class="mem-set-membr-f ">{{user.get_membership_display}}({{user.get_company_type_display}})</span>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-1">
                        <label class="form-title mem-setup-blu-f">Website</label>
                    </div>
                    <div class="col-4">
                        <input class="inp-line" placeholder="Website"
                            name="{{ form.company_website.name }}"
                            value="{% if user.company_website %}{{ user.company_website}}{% endif%}"
                            autocomplete="off"/>
                            {% if errors.company_website %}
                            {% for err in errors.company_website %}
                            <p style="color: red">{{err}}</p>
                            {% endfor %}
                            {% endif %}
                    </div>
                    <div class="col-1">
                        <label class="form-title mem-setup-blu-f">IMDB</label>
                    </div>
                    <div class="col-4">
                        <input class="inp-line" placeholder="IMDB"
                        name="{{ form.imdb.name }}"
                        value="{% if profile.imdb %}{{ profile.imdb}}{% endif%}"
                        autocomplete="off"/>
                        {% if errors.imdb %}
                        {% for err in errors.imdb %}
                        <p style="color: red">{{err}}</p>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-3">
                        <label class="form-title mem-setup-blu-f">Submission Policy - SAMR:</label>
                    </div>
                    <div class="col-5  mt-3">
                        <ul class="list-unstyled settings-checkbx-f ml-4 w-100">
                            <li>
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input type="radio"
                                        name="submission_policy_SAMR" value="members_with_rating"
                                        {% if profile.submission_policy_SAMR != 'pros_and_companies_only' %}
                                            checked
                                        {% endif %}
                                        class="radio-settings form-check-input">
                                        <span class="rate"> Members with Rating &nbsp;
                                            <input type="radio" id="star5" name="rate" value="5"
                                            {% if profile.submission_policy_SAMR == 'members_with_rating_5_star' %}checked{% endif %}/>
                                            <label for="star5" title="text">5 stars</label>

                                            <input type="radio" id="star4" name="rate" value="4"
                                            {% if profile.submission_policy_SAMR == 'members_with_rating_4_star' %}checked{% endif %}/>
                                            <label for="star4" title="text">4 stars</label>

                                            <input type="radio" id="star3" name="rate" value="3"
                                            {% if profile.submission_policy_SAMR == 'members_with_rating_3_star' %}checked{% endif %}/>
                                            <label for="star3" title="text">3 stars</label>

                                            <input type="radio" id="star2" name="rate" value="2"
                                            {% if profile.submission_policy_SAMR == 'members_with_rating_2_star' %}checked{% endif %}/>
                                            <label for="star2" title="text">2 stars</label>

                                            <input type="radio" id="star1" name="rate" value="1"
                                            {% if profile.submission_policy_SAMR == 'members_with_rating_1_star' %}checked{% endif %}/>
                                            <label for="star1" title="text">1 star</label>

                                        </span>
                                    </label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input type="radio" 
                                        name="submission_policy_SAMR" value="pros_and_companies_only"
                                        {% if profile.submission_policy_SAMR == 'pros_and_companies_only' %}
                                        checked
                                        {% endif %}
                                        class="radio-settings form-check-input" />
                                        Pros and Companies only
                                    </label>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-10">
                    <div class="form-group">
                        <label for="comment" class="form-title mem-setup-blu-f ml-2"> Bio/Info</label>
                        <textarea class="form-control" rows="4"
                            name="{{ form.bio.name }}">
                            {% if profile.bio %}{{ profile.bio}}{% endif%}
                            </textarea>
                            {% if errors.bio %}
                            {% for err in errors.bio %}
                            <p style="color: red">{{err}}</p>
                            {% endfor %}
                            {% endif %}
                      </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-11">
                        <input type="submit" class="btn mem-setup-blu-f float-right save_btn" value="Save"/>
                    </div>
                </div>
            </form>
            {% if user.membership == 'COM' %}
                <hr class="mem-set-acc-hr">
                <div class="bold mt-3">Staff</div>
                <div class="row ">
                    <div class="col-md-5 coworkers">
                        {% for coworker in coworkers %}
                        <input name="saved_id" type="hidden" value="{{coworker.id}}" />
                        {% if coworker.user %}
                        <div>
                            {% if coworker.user.membership != 'COM' %}
                                <a href="{% url 'hobo_user:profile' coworker.user.id %}"
                                target="_blank">
                            {%  elif coworker.user.membership == 'COM' and coworker.user.company_type == 'production' %}
                                <a href="{% url 'hobo_user:production-company-profile' coworker.user.id %}"
                                target="_blank">
                            {%  elif coworker.user.membership == 'COM' and coworker.user.company_type == 'agency_management' %}
                                <a href="{% url 'hobo_user:agency-management-company-profile' coworker.user.id %}" target="_blank" >
                            {% endif %}
                            <span>{{coworker.name}}</span>
                            </a>({{coworker.position.title}})
                            <label class="form-check-label mem-setup-blu-f"
                            data-toggle="modal"
                            data-target="#warning{{coworker.id}}"
                            for="">Remove</label>
                       </div>
                        {% else %}
                        <div>
                            <span>{{coworker.name}}({{coworker.position.title}})</span>
                            <label class="form-check-label mem-setup-blu-f"
                            data-toggle="modal"
                            data-target="#warning{{coworker.id}}"
                            for="">Remove</label>
                      </div>
                        {% endif %}
                        <!-- The Modal -->
                        <div class="modal fade" id="warning{{coworker.id}}">
                            <div class="modal-dialog">
                            <div class="modal-content">

                                <!-- Modal Header -->
                                <div class="modal-header">
                                <h5 class="modal-title">Warning !!</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>

                                <!-- Modal body -->
                                <div class="modal-body">
                                    Do you want to delete staff {{coworker.name}}?
                                </div>

                                <!-- Modal footer -->
                                <div class="modal-footer">
                                <a class="btn btn-outline-danger btn-sm delete-coworker" id="{{coworker.id}}" data-dismiss="modal">Yes</a>
                                <button type="button" class="btn btn-outline-danger btn-sm" data-dismiss="modal">No</button>
                                </div>

                            </div>
                            </div>
                        </div>
                        <!-- end of modal -->
                    {% endfor %}
                    </div>
                    <div class="col-md-5">
                        <input name="name" id="coworker_name" value=""
                        class="inp-line" placeholder="Name"
                        autocomplete="off" /><br>

                        <input name="name" id="coworker_email" value=""
                        class="inp-line" placeholder="Email"
                        autocomplete="off" />

                        <select name="designation" id="coworker_position"
                        class="form-control form-control-input mt-2">
                            <option value="" selected disabled hidden>Choose position</option>
                            {% for job in job_types %}
                            <option value="{{job.id}}" >
                            {{job}}</option>
                            {% endfor %}
                        </select>
                        <div class="col-10 add-coworker-error-msg"></div>
                        <a class="btn mem-setup-blu-f float-right save_btn add-coworker">Attach</a>
                    </div>
                </div>
                <hr class="mem-set-acc-hr">
                <div class="bold ">My interests</div>
                        <form method="post" action="{% url 'hobo_user:add-user-interest' %}">
                            {% csrf_token %}
                        <div class="my-interests-section">
                        <div class="row">
                            <div class="col-3">Position
                                <select name="position" id="position_1"
                                class="form-control form-control-input mt-2" required>
                                    {% for position in my_interest_form.position %}
                                        {{position}}
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-3">Format
                                <select name="format" id = "format_1"
                                class="form-control form-control-input mt-2 " required>
                                    {% for item in my_interest_form.format %}
                                    {{item}}
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-3">Location
                                <select name="location" id ="location_1"
                                class="form-control form-control-input mt-2 " required>
                                    {% for item in my_interest_form.location %}
                                    {{item}}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-2">
                                <a class="btn mem-setup-blu-f  save_btn" id="add-more-interests">Add More</a>
                            </div>
                            <div class="col-2">
                                <input type="submit" class="btn mem-setup-blu-f  save_btn" value="Save"/>
                            </div>
                        </div>
                        </form>
            {% endif %}
                <hr class="mem-set-acc-hr">
                <div class="bold ">My Projects</div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extrajs %}
<script src="https://code.jquery.com/jquery-migrate-3.0.0.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css" />
<script>

    $(document).ready(function() {
        $('#coworker_position').select2();
        $('#location_1').select2();
        $('#position_1').select2();
        $('#format_1').select2();
    });

// add coworker - filmhobo users
// var count=1;
// $('body').on('click' , '.repeat', function(){
//     count++
//     var user_id ="#user"+count
//     var position_id ="#position"+count
//     data_dict = {'count':count}
//     // get add coworker form
//     $.get('/hobo_user/add-coworker-form/', data_dict)
//     .done(function(data) {
//     if(data.results!='')
//         {
//             $('.sec-1').append(data['add_coworker_form_html']);
//             $(user_id).select2();
//             $(position_id).select2();
//         }
//     });
// });

// add more - my interests
var count=1;
$('body').on('click' , '#add-more-interests', function(){
    count++
    var location_id ="#location_"+count
    var position_id ="#position_"+count
    var format_id ="#format_"+count
    var data_dict = {}
    data_dict = {'count':count}
    // get add coworker form
    $.get('/hobo_user/add-user-interest-form/',data_dict)
    .done(function(data) {
    if(data.results!='')
        {
            $('.my-interests-section').append(data['add_my_interests_form_html']);
            $(location_id).select2();
            $(position_id).select2();
            $(format_id).select2();
        }
    });
});


$('body').on('click' , '.add-coworker', function(){
    var name = $("#coworker_name").val();
    var token = $("#token").val();
    var email = $("#coworker_email").val();
    var position = $("#coworker_position").find("option:selected").val();
    var error_msg1 = ""
    var error_msg2 = ""
    var error_msg3 = ""
    data_dict = {}
    if(name!= ""){
        data_dict['name']=name;
    }else{
        error_msg1 = "Name cannot be empty."
    }
    if(email!= ""){
        data_dict['email']=email;
    }else{
        error_msg2 = "Email cannot be empty."
    }
    if(position!= ""){
        data_dict['position']=position;
    }else{
        error_msg3 = "Position cannot be empty."
    }
    if(error_msg1 == "" & error_msg2 == "" & error_msg3 == ""){
        // add coworker
        $.ajax
            ({
                type: "POST",
                url: "/hobo_user/add-coworker-api/",
                dataType: 'json',
                async: false,
                data: data_dict,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader ("Authorization", token);
                },
                error: function(data){
                    $('.add-coworker-error-msg').html("");
                    $('.add-coworker-error-msg').html("Enter a vaild email address.");
                },
                success: function (response){
                    var coworker_id = response['id']
                    console.log(response['errors'])
                    if(response.errors){
                        $('.add-coworker-error-msg').html("");
                        $('.add-coworker-error-msg').html(
                            "<div class='errormsg'>Enter a vaild email address.</div>"
                            );
                    }else{
                        $.get('/hobo_user/attach-coworker/', {'id':coworker_id})
                        .done(function(data) {
                            if(data.results!='')
                                {
                                    $('.add-coworker-error-msg').html("");
                                    $('.coworkers').append(data['attach_coworker_html']);
                                    window.location.reload();
                                }
                        });
                    }
                }
            });
    }else{
        $('.add-coworker-error-msg').html("");
        if(error_msg1 != ""){
            $('.add-coworker-error-msg').append(
            "<div class='errormsg'>"+error_msg1+"</div>"
            );
        }
        if(error_msg2 != ""){
            $('.add-coworker-error-msg').append(
            "<div class='errormsg'>"+error_msg2+"</div>"
            );
        }
        if(error_msg3 != ""){
            $('.add-coworker-error-msg').append(
            "<div class='errormsg'>"+error_msg3+"</div>"
            );
        }

    }
});


$('body').on('click' , '.delete-coworker', function(){
    var id = $(this).attr('id');
    var token = $("#token").val();
    var data_dict = {}
    data_dict['id'] = id
    $.ajax
        ({
            type: "POST",
            url: "/hobo_user/remove-coworker-api/",
            dataType: 'json',
            async: false,
            data: data_dict,
            beforeSend: function (xhr) {
                xhr.setRequestHeader ("Authorization", token);
            },
            error: function(data){
            },
            success: function (response){
                console.log(response['id'])
                window.location.reload()
            }
        });
    });
</script>
{% endblock %}


